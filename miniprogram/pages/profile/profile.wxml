<!-- 我的 - 用户中心页面 -->
<view class="page-container">
  <!-- 用户信息头部 -->
  <view class="user-header">
    <!-- 未登录状态 -->
    <view wx:if="{{!isLoggedIn}}" class="login-section">
      <view class="login-avatar-wrap">
        <t-avatar class="login-avatar" icon="user" size="128rpx" />
      </view>
      <view class="login-text">登录后体验完整功能</view>
      <button 
        class="login-btn" 
        bindtap="onLoginTap" 
        loading="{{isLoading}}"
      >
        微信一键登录
      </button>
    </view>

    <!-- 已登录状态 -->
    <view wx:else class="user-profile">
      <t-avatar 
        class="user-avatar" 
        image="{{userInfo.avatar}}" 
        icon="{{userInfo.avatar ? '' : 'user'}}"
        size="130rpx"
      />
      <view class="user-info">
        <view class="user-name">{{userInfo.nickname}}</view>
        <view class="user-signature">{{userInfo.signature || '这个人很懒，什么都没写~'}}</view>
      </view>
    </view>
  </view>
  
  <!-- 内容区域 -->
  <scroll-view class="content-container" scroll-y enhanced show-scrollbar="{{false}}">
    <!-- 余额卡片 -->
    <view class="balance-card" bindtap="onMenuTap" data-type="recharge">
      <view class="balance-label">当前余额</view>
      <view class="balance-value">
        <text class="balance-number">{{userInfo.balance}}</text>
        <text class="balance-unit">创作点</text>
      </view>
      <view class="balance-action">去充值</view>
    </view>

    <!-- 我的作品 -->
    <view class="section">
      <view class="section-header">
        <view class="section-title">🎨 我的作品</view>
        <view class="section-more" bindtap="onViewAllWorks">查看全部 →</view>
      </view>
      <scroll-view class="works-scroll" scroll-x enhanced show-scrollbar="{{false}}">
        <view 
          wx:for="{{works}}" 
          wx:key="id"
          class="work-card"
          bindtap="onWorkTap"
          data-id="{{item.id}}"
        >
          <t-image 
            src="{{item.image}}" 
            class="work-image"
            mode="aspectFill"
          />
          <view class="work-info">
            <view class="work-name">{{item.name}}</view>
            <view class="work-date">{{item.date}}</view>
          </view>
        </view>
        
        <!-- 空状态 -->
        <view wx:if="{{works.length === 0}}" class="empty-works">
          <t-icon name="folder-open" size="80rpx" color="#ccc" />
          <text class="empty-text">暂无角色卡，快去创建吧~</text>
        </view>
      </scroll-view>
    </view>
    
    <!-- 菜单列表 -->
    <view class="menu-section">
      <!-- 编辑资料 -->
      <view class="menu-item" bindtap="onEditProfile">
        <view class="menu-icon">
          <t-icon name="edit" size="40rpx" color="#fff" />
        </view>
        <view class="menu-content">
          <view class="menu-title">编辑资料</view>
          <view class="menu-subtitle">修改头像昵称等信息</view>
        </view>
        <t-icon name="chevron-right" size="40rpx" color="#ccc" />
      </view>

      <!-- 使用指南 -->
      <view class="menu-item" bindtap="onMenuTap" data-type="guide">
        <view class="menu-icon">
          <t-icon name="help-circle" size="40rpx" color="#fff" />
        </view>
        <view class="menu-content">
          <view class="menu-title">使用指南</view>
          <view class="menu-subtitle">了解如何创建角色</view>
        </view>
        <t-icon name="chevron-right" size="40rpx" color="#ccc" />
      </view>
      
      <!-- 意见反馈 -->
      <view class="menu-item" bindtap="onMenuTap" data-type="feedback">
        <view class="menu-icon">
          <t-icon name="chat" size="40rpx" color="#fff" />
        </view>
        <view class="menu-content">
          <view class="menu-title">意见反馈</view>
          <view class="menu-subtitle">帮助我们做得更好</view>
        </view>
        <t-icon name="chevron-right" size="40rpx" color="#ccc" />
      </view>
      
      <!-- 余额充值 -->
      <view class="menu-item" bindtap="onMenuTap" data-type="recharge">
        <view class="menu-icon">
          <t-icon name="wallet" size="40rpx" color="#fff" />
        </view>
        <view class="menu-content">
          <view class="menu-title">余额充值</view>
          <view class="menu-subtitle">购买创作点</view>
        </view>
        <t-icon name="chevron-right" size="40rpx" color="#ccc" />
      </view>
      
      <!-- 关于我们 -->
      <view class="menu-item" bindtap="onMenuTap" data-type="about">
        <view class="menu-icon">
          <t-icon name="info-circle" size="40rpx" color="#fff" />
        </view>
        <view class="menu-content">
          <view class="menu-title">关于我们</view>
          <view class="menu-subtitle">版本 {{version}}</view>
        </view>
        <t-icon name="chevron-right" size="40rpx" color="#ccc" />
      </view>

      <!-- 退出登录 (仅登录后显示) -->
      <view wx:if="{{isLoggedIn}}" class="menu-item logout-item" bindtap="onLogout">
        <view class="menu-icon logout-icon">
          <t-icon name="poweroff" size="40rpx" color="#fff" />
        </view>
        <view class="menu-content">
          <view class="menu-title logout-text">退出登录</view>
          <view class="menu-subtitle">清除当前登录状态</view>
        </view>
        <t-icon name="chevron-right" size="40rpx" color="#ccc" />
      </view>
    </view>
    
    <!-- 底部占位 -->
    <view class="bottom-placeholder"></view>
  </scroll-view>
</view>

<!-- 注册信息收集弹窗 -->
<t-popup 
  visible="{{showRegisterPopup}}" 
  placement="bottom"
  bind:visible-change="onRegisterCancel"
>
  <view class="register-popup">
    <view class="register-title">完善个人信息</view>
    <view class="register-subtitle">设置你的头像和昵称</view>

    <!-- 头像选择 -->
    <view class="register-avatar-section">
      <button class="avatar-choose-btn" open-type="chooseAvatar" bindchooseavatar="onChooseAvatar">
        <t-avatar 
          class="register-avatar" 
          image="{{registerAvatar}}" 
          icon="{{registerAvatar ? '' : 'user'}}"
          size="160rpx"
        />
        <view class="avatar-tip">点击选择头像</view>
      </button>
    </view>

    <!-- 昵称输入 -->
    <view class="register-nickname-section">
      <input 
        class="nickname-input" 
        type="nickname" 
        placeholder="请输入昵称" 
        value="{{registerNickname}}"
        bindinput="onNicknameInput"
        maxlength="20"
      />
    </view>

    <!-- 个性签名输入 -->
    <view class="register-nickname-section">
      <input 
        class="nickname-input" 
        placeholder="写一句个性签名吧" 
        value="{{registerSignature}}"
        bindinput="onSignatureInput"
        maxlength="50"
      />
    </view>

    <!-- 操作按钮 -->
    <view class="register-actions">
      <button class="register-cancel-btn" bindtap="onRegisterCancel">跳过</button>
      <button class="register-confirm-btn" bindtap="onRegisterConfirm" loading="{{isLoading}}">确认</button>
    </view>
  </view>
</t-popup>
